{% extends 'base.html' %}
{% load static %}
{% block body %}
    <div class="pcoded-content">
      <div class="page-header card">
        <div class="row align-items-end">
          <div class="col-lg-8">
            <div class="page-header-title">
              <div class="d-inline">
                  <h5><a href="{% url 'qrcodes/' %}"><i class="icofont icofont-simple-left"></i></a>QR Code History</h5>
              </div>
            </div>
          </div>
          <div class="col-lg-4">

          </div>
        </div>
      </div>
      <div class="page-header card">
          <div class="card">
            <div class="card-block">
              <div class="qr-code-history-part clearfix">
                   <!-- <div class="image">
                        <img src="img/qr-img.jpg" alt="">
                   </div> -->
                   <div class="text v-product-top">
                        <div class="row">
                                <div class="col-xl-6 col-lg-12 col-sm-12">
                                     <div class="form-group row">
                                            <label class="col-sm-4 col-form-label">QR Code ID</label>
                                            <div class="col-sm-8">
                                                 <h4>{{ data.qr_code.qr_image }}</h4>
                                            </div>
                                     </div>
                                </div>

                                <div class="col-xl-6 col-lg-12 col-sm-12">
                                     <!-- <div class="form-group row">
                                            <label class="col-sm-4 col-form-label">Merchant Name</label>
                                            <div class="col-sm-8">
                                                 <h4>{{ data.merchant_name }}</h4>
                                            </div>
                                     </div> -->
                                </div>
                                <div class="col-xl-6 col-lg-12 col-sm-12">
                                     <div class="form-group row">
                                            <label class="col-sm-4 col-form-label">Product Name</label>
                                            <div class="col-sm-8">
                                                 <h4>{{ data.product_name }}</h4>
                                            </div>
                                     </div>
                                </div>
                        <!--</div>-->
                        <!--<div class="row">-->
                                <div class="col-xl-6 col-lg-12 col-sm-12">
                                     <div class="form-group row">
                                            <label class="col-sm-4 col-form-label">Batch Number</label>
                                            <div class="col-sm-8">
                                                 <h4>{{ data.qr_code.batch_id }}</h4>
                                            </div>
                                     </div>
                                </div>

                                <div class="col-xl-6 col-lg-12 col-sm-12">
                                     <div class="form-group row">
                                            <label class="col-sm-4 col-form-label">Total Points</label>
                                            <div class="col-sm-8">
                                                 <h4>{{ data.product_point }}</h4>
                                            </div>
                                     </div>

                                </div>

                                <div class="col-xl-6 col-lg-12 col-sm-12">
                                    <div class="form-group row">
                                        <label class="col-sm-4 col-form-label">QR Code Scan Status</label>
                                            <div class="col-sm-8">
                                                <h4>{{ data.qr_status }}</h4>
                                            </div>
                                    </div>
                                </div>

                                <div class="col-xl-6 col-lg-12 col-sm-12">
                                    <div class="form-group row">
                                        <label class="col-sm-4 col-form-label">Weather Information</label>
                                        <div class="col-sm-8">
                                            <h4>Humidity : {{ data.qr_code.humidity }} %<br /> Wind Speed : {{ data.qr_code.wind_speed }} m/s<br /> Temperature : {{ data.qr_code.temp }} Â°C</h4>
                                        </div>
                                    </div>
                                </div>

                        </div>


                   </div>
              </div>
            </div>
          </div>

          <div class="page-header-title p-b-15">
               <h5>Owner</h5>
          </div>

          <div class="card">
               <div class="card-block">
                    <div class="v-product-top">
                    <div class="row">
                                <div class="col-xl-6 col-lg-12 col-sm-12">
                                     <div class="form-group row">
                                            <label class="col-sm-4 col-form-label">Name</label>
                                            <div class="col-sm-8">
                                                 <h4>{{ data.user_id.full_name }}</h4>
                                            </div>
                                     </div>
                                </div>
                                <div class="col-xl-6 col-lg-12 col-sm-12">
                                     <div class="form-group row">
                                            <label class="col-sm-4 col-form-label">Email Address</label>
                                            <div class="col-sm-8">
                                                 <h4>{{ data.user_id.email }}</h4>
                                            </div>
                                     </div>
                                </div>
                        </div>
                    <div class="row">
                                <div class="col-xl-6 col-lg-12 col-sm-12">
                                     <div class="form-group row">
                                            <label class="col-sm-4 col-form-label">Location</label>
                                            <div class="col-sm-8">
                                                 <h4>{{ data.qr_code.scanned_location }}</h4>
                                            </div>
                                     </div>
                                </div>
                        </div>
                    </div>
               </div>
          </div>

          <div class="page-header-title p-b-15">
               <h5>Product Activation Questions</h5>
          </div>

          <div class="card">
               <div class="card-block">
                    <div class="v-product-top">
                        <div class="row">
                                    <div class="col-xl-6 col-lg-12 col-sm-12">
                                         <div class="form-group row">
                                                <label class="col-sm-4 col-form-label">A Side Batch</label>
                                                <div class="col-sm-8">
                                                     <h4>{{ data.product_activation_questions.a_side_batch }}</h4>
                                                </div>
                                         </div>
                                    </div>
                                    <div class="col-xl-6 col-lg-12 col-sm-12">
                                         <div class="form-group row">
                                                <label class="col-sm-4 col-form-label">A Side Set Temperature</label>
                                                <div class="col-sm-8">
                                                     <h4>{{ data.product_activation_questions.a_side_set_temp }}</h4>
                                                </div>
                                         </div>
                                    </div>
                        </div>
                        <div class="row">
                                    <div class="col-xl-6 col-lg-12 col-sm-12">
                                         <div class="form-group row">
                                                <label class="col-sm-4 col-form-label">B Side Set Temperature</label>
                                                <div class="col-sm-8">
                                                     <h4>{{ data.product_activation_questions.b_side_set_temp }}</h4>
                                                </div>
                                         </div>
                                    </div>

                                    <div class="col-xl-6 col-lg-12 col-sm-12">
                                         <div class="form-group row">
                                                <label class="col-sm-4 col-form-label">Hose Set Temperature</label>
                                                <div class="col-sm-8">
                                                     <h4>{{ data.product_activation_questions.hose_set_temp }}</h4>
                                                </div>
                                         </div>
                                    </div>
                        </div>

                        <div class="row">
                                    <div class="col-xl-6 col-lg-12 col-sm-12">
                                         <div class="form-group row">
                                                <label class="col-sm-4 col-form-label">Pressure Set</label>
                                                <div class="col-sm-8">
                                                     <h4>{{ data.product_activation_questions.pressure_set }}</h4>
                                                </div>
                                         </div>
                                    </div>

                                    <div class="col-xl-6 col-lg-12 col-sm-12">
                                         <div class="form-group row">
                                                <label class="col-sm-4 col-form-label">Mixing Chamber Size</label>
                                                <div class="col-sm-8">
                                                     <h4>{{ data.product_activation_questions.mixing_chamber_size }}</h4>
                                                </div>
                                         </div>
                                    </div>
                        </div>

                         <div class="row">
                              <div class="col-xl-6 col-lg-12 col-sm-12">
                                   <div class="form-group row">
                                        <label class="col-sm-4 col-form-label">Start Drum Temperature</label>
                                        <div class="col-sm-8">
                                             <h4>{{ data.product_activation_questions.start_drum_temp }}</h4>
                                        </div>
                                   </div>
                              </div>
                              <div class="col-xl-6 col-lg-12 col-sm-12">
                                   <div class="form-group row">
                                        <label class="col-sm-4 col-form-label">Machine Type</label>
                                        <div class="col-sm-8">
                                             <h4>{{ data.product_activation_questions.machine_type.machine_type }}</h4>
                                        </div>
                                   </div>
                              </div>
                         </div>

                         <div class="row">
                              <div class="col-xl-6 col-lg-12 col-sm-12">
                                   <div class="form-group row">
                                        <label class="col-sm-4 col-form-label">Substrate Type</label>
                                        <div class="col-sm-8">
                                             <h4>{{ data.product_activation_questions.substrate_type.substrate_type }}</h4>
                                        </div>
                                   </div>
                              </div>
                              <div class="col-xl-6 col-lg-12 col-sm-12">
                                   <div class="form-group row">
                                        <label class="col-sm-4 col-form-label">Substrate Temp</label>
                                        <div class="col-sm-8">
                                             <h4>{{ data.product_activation_questions.substrate_temp }}</h4>
                                        </div>
                                   </div>
                              </div>
                         </div>
                         <div class="row">
                              <div class="col-xl-6 col-lg-12 col-sm-12">
                                   <div class="form-group row">
                                        <label class="col-sm-4 col-form-label">Substrate Moisture</label>
                                        <div class="col-sm-8">
                                             <h4>{{ data.product_activation_questions.substrate_moisture }}</h4>
                                        </div>
                                   </div>
                              </div>
                              <div class="col-xl-6 col-lg-12 col-sm-12">
                                   <div class="form-group row">
                                        <label class="col-sm-4 col-form-label">Safety warning signs Posted?</label>
                                        <div class="col-sm-8">
                                             <h4>{{ data.product_activation_questions.saftey_warning_signs_posted }}</h4>
                                        </div>
                                   </div>
                              </div>
                         </div>
                         <div class="row">
                              <div class="col-xl-6 col-lg-12 col-sm-12">
                                   <div class="form-group row">
                                        <label class="col-sm-4 col-form-label">Mechanical Ventilation Used</label>
                                        <div class="col-sm-8">
                                             <h4>{{ data.product_activation_questions.mechanical_ventilation_used }}</h4>
                                        </div>
                                   </div>
                              </div>
                              <div class="col-xl-6 col-lg-12 col-sm-12">
                                   <div class="form-group row">
                                        <label class="col-sm-4 col-form-label">Sprayer Using Fresh Air?</label>
                                        <div class="col-sm-8">
                                             <h4>{{ data.product_activation_questions.sprayer_using_fresh_air }}</h4>
                                        </div>
                                   </div>
                              </div>
                         </div>
                         <div class="row">
                              <div class="col-xl-6 col-lg-12 col-sm-12">
                                   <div class="form-group row">
                                        <label class="col-sm-4 col-form-label">Complete After Spraying</label>
                                        <div class="col-sm-8">
                                             <h4>{{ data.product_activation_questions.complete_after_spraying }}</h4>
                                        </div>
                                   </div>
                              </div>
                              <div class="col-xl-6 col-lg-12 col-sm-12">
                                   <div class="form-group row">
                                        <label class="col-sm-4 col-form-label">Image<a href="#" class="f-16 d-inline-block align-top"><i class="icofont"></i></a></label>
                                        <div class="prof-pic-part prof-pic-part-admin">
                                             <div class="prof-pic-img col-sm-8">
                                                  <img src={{ data.product_activation_questions.image }} alt="" id="product_fake_image">
                                             </div>
                                        </div>
                                   </div>
                              </div>
                              
                         </div>
                    </div>
               </div>
          </div>

          <div class="page-header-title p-b-15">
               <h5>Dispute Requests</h5>
          </div>
          <div class="card">
               <div class="card-block">
                    <div class="dt-responsive table-responsive">
                <table id="multi-colum-dt1" class="table table-striped table-bordered nowrap" cellpadding="0" cellspacing="0">
                  <thead>
                    <tr>
                      <th>Date-Time</th>
                      <th>User's Email Address</th>
                      <th>Status</th>
                      <th>User's Message</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for dispute in data.dispute_requests %}
                    <tr>
                      <td>29-08-2019, 22-08-45</td>
                      <td>{{ dispute.user_email }}</td>
                      <td>{{ dispute.dispute_status }}</td>
                      <td>{{ dispute.message }}</td>
                        {% if dispute.dispute_status != "Resolved" %}
                            <td><button class="btn btn-primary"><a style="color: #fff;" class="resolve-class" onclick="qr()" href="#" data-url="{% url 'dispute/resolved/' id=dispute.id %}">Mark as solved</a></button></td>
                        {% else %}
                            <td>Resolved</td>
                        {% endif %}
                    </tr>
                  {% endfor %}
                  </tbody>
                </table>
              </div>
               </div>
          </div>
      </div>
    </div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/8.11.8/sweetalert2.all.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
<script>

    function qr () {
        const swalWithBootstrapButtons = Swal.mixin({
        customClass: {
            confirmButton: 'btn btn-success',
            cancelButton: 'btn btn-danger',
        },
        buttonsStyling: false
        })

    swalWithBootstrapButtons.fire({
        title: 'Are you sure to want to resolve this?',
        text: "You won't be able to revert this!",
        type: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, Resolve it!',
        cancelButtonText: 'No, cancel!',
        reverseButtons: true
    }).then((result) => { console.log('result--',result.value, result)
      if (result.value) {

          var url = $('.resolve-class').attr('data-url');
        console.log(url);
        var qr_id = parseInt($('.resolve-class').parent().prev().prev().prev().text());
        console.log('qr_id---', qr_id);
        var email = $('.resolve-class').parent().prev().prev().text();
        console.log('email---', email);

        console.log(url);
        var htmlText = `<span>Resolved</span>`
        var splitUrl = url.split('/')
        // var email = $('.resolve-class').parent().prev().prev().text();

        $.ajax({

            url: url,
            type: "POST",
            dataType: 'json',
            data: {
                'qr_id': qr_id,
                'email': email,
                'deleted':true,

            },
            {#success: function (data) {#}
            {#    var selection = $(".resolve-class");#}
            {#    selection.html("Resolved");#}
            {#    console.log('success');#}
            {#}#}


            success: function (data) {
                 swalWithBootstrapButtons.fire(
                  'Resolved!',
                  'Dispute request has successfully resolved.',
                  'success',
                )
                if($('.swal2-confirm').html() == 'OK') {
                    $('.swal2-confirm').css('display', 'none');
                }
                 function redirect(){
                    window.location.reload();
                }
                setTimeout(redirect, 2000); //2000 is equivalent to 2 seconds
                {#ele.remove()#}
                {#ele.html(htmlText)#}
                ele.replaceWith(htmlText);
                console.log('success');
            }

        });
      }

    })

    }
</script>

<script type="text/javascript" src="{% static 'js/jquery.min.js' %}"></script>
{#<script>#}
{#    function qr () {#}
{#        var url = $('.resolve-class').attr('data-url');#}
{#        console.log(url);#}
        {#var qr_id = parseInt($('.resolve-class').parent().prev().prev().prev().text());#}
        {#console.log('qr_id---', qr_id);#}
        {#var email = $('.resolve-class').parent().prev().prev().text();#}
        {#console.log('email---', email);#}
{#        $.ajax({#}
{#            url: url,#}
{#            type: "POST",#}
{#            dataType: 'json',#}
{#            data: {#}
                {#'qr_id': qr_id,#}
                {#'email': email#}
{#            },#}
{#            success: function (data) {#}
{#                var selection = $(".resolve-class");#}
{#                selection.html("Resolved");#}
{#                selection.attr('href','');#}
{#                console.log('success');#}
{#            }#}
{#        })#}
{#    }#}
{#</script>#}

{% endblock %}